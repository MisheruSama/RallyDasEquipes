<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Login Admin - Rally das Equipes</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="admin-styles.css">
</head>
<body class="inv-bg">
  <div class="container login-container">
    <div class="login-wrapper">
      <div class="login-card">
        <div class="login-brand">
          <img src="imagem/logo.png" alt="Rally das Equipes" class="login-logo">
          <h1>Administração</h1>
        </div>
        <p class="login-sub">Acesse o painel administrativo</p>

        <form id="loginForm" class="login-form">
          <div class="form-floating mb-3">
            <input type="text" class="form-control bg-dark text-white" id="login" placeholder="login" required>
            <label for="login">Usuário</label>
          </div>
          <div class="form-floating mb-3">
            <input type="password" class="form-control bg-dark text-white" id="password" placeholder="senha" required>
            <label for="password">Senha</label>
          </div>

          <div class="d-flex align-items-center justify-content-between mb-3">
            <div>
              <input type="checkbox" id="remember" /> <label for="remember">Lembrar-me</label>
            </div>
            <a href="/" class="text-decoration-none text-muted">Voltar ao site</a>
          </div>

          <div class="d-grid">
            <button id="loginBtn" class="btn btn-inv-primary btn-lg" type="submit">
              <span class="btn-text">Entrar</span>
              <span class="btn-spinner" style="display:none"></span>
            </button>
          </div>
        </form>

        <div id="message" class="mt-3 login-message" aria-live="polite"></div>
      </div>
    </div>
  </div>

    <script>
    // Helper to show messages
    function mostrarMensagem(text, tipo='danger'){
      const msg = document.getElementById('message');
      msg.innerHTML = `<div class="alert alert-${tipo}" role="alert">${text}</div>`;
    }

    // Add small animation on load
    document.addEventListener('DOMContentLoaded', () => {
      const card = document.querySelector('.login-card');
      if (card) {
        // add entering class and keep it so the card remains visible after the animation
        card.classList.add('entering');
      }
    });

    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const login = document.getElementById('login').value.trim();
      const password = document.getElementById('password').value.trim();
      const loginBtn = document.getElementById('loginBtn');
      const spinner = loginBtn.querySelector('.btn-spinner');
      const btnText = loginBtn.querySelector('.btn-text');

      // show spinner
      spinner.style.display = 'inline-block';
      btnText.style.opacity = '0.6';
      loginBtn.disabled = true;

      try{
        const res = await fetch('/auth/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ login: login, password: password })
        });

        if (!res.ok) {
          const txt = await res.text();
          throw new Error(txt || 'Credenciais inválidas');
        }

        const data = await res.json();
        const token = data.token;
        if (!token) throw new Error('Token não retornado');

        // Save token cookie (not HttpOnly) so backend filter can read it
        document.cookie = `token=${token}; path=/`;

        // small success animation then redirect
        mostrarMensagem('Login bem sucedido! Redirecionando...', 'success');
        setTimeout(() => window.location.href = '/admin.html', 700);

      } catch(err){
        console.error(err);
        mostrarMensagem(err.message || 'Erro ao fazer login', 'danger');
      } finally {
        spinner.style.display = 'none';
        btnText.style.opacity = '1';
        loginBtn.disabled = false;
      }
    });
    </script>
</body>
</html>
